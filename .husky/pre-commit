#!/bin/sh
# Auto-format staged files before committing
echo "ğŸ”§ Running prettier to format staged code..."

# Get list of staged files before formatting
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM)

# Run prettier on all files (existing behavior)
npm run format || {
  echo "âŒ Failed to run prettier. Please check your installation."
  exit 1
}

# Re-stage only the files that were originally staged
if [ -n "$STAGED_FILES" ]; then
  echo "$STAGED_FILES" | xargs git add 2>/dev/null || true
fi

# Run linting
npm run lint || {
  echo "âŒ Linting errors detected. Please fix the errors and try again."
  exit 1
}

echo "âœ… Pre-commit checks passed! Code has been formatted."
